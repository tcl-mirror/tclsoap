<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <link  rel="stylesheet" type="text/css" href="tclsoap.css">
    <title>XML-RPC URL Domain Package for TclHTTPD</title>
    <meta http-equiv="Description" name="Description"
      content="XML-RPC package for Tcl. Provides remote procedure calls
      using the XML-RPC protocol over HTTP." />
    <meta http-equiv="Keywords" name="Keywords"
      content="Tcl,XML-RPC,SOAP,Simple Object Access Protocol,XML,tclHTTPD" />
  </head>

  <!-- --------------------------------------------------------------------- -->

  <body>
  <table class="globaltable">
  <tr><td class="header" width="15%">
      <a href="http://sourceforge.net">
         <img align="middle" alt="SourceForge Logo" border="0" height="31" 
             src="http://sourceforge.net/sflogo.php?group_id=25970"
             width="88"></a>
      </td>
      <td class="header" width="70%">
           <h1>Tcl XML-RPC Server Utility Package</h1>
      </td>
      <td class="logo" width="15%">
        <img src="tclsoap.gif" alt="TclSOAP Logo" align="middle"
        border="0" height="84" width="57" />
      </td>
  </tr>

  <tr><td class="sidebar">
    <table>
<tr><td class="sidehead">Project</td></tr>
<tr><td class="sideelt"><A href="http://sourceforge.net/projects/tclsoap">Project Page</A></td></tr>
<tr><td class="sideelt"><A href="http://sourceforge.net/project/showfiles.php?group_id=25970">File Releases</A></td></tr>
<tr><td class="sideelt"><A href="TclSOAP.html">WebPage</A></td></tr>
<tr><td class="sideelt"><A href="http://sourceforge.net/docman/?group_id=25970">Documentation</A></td></tr>
<tr><td class="sideelt"><A href="http://sourceforge.net/forum/?group_id=25970">Forums</A></td></tr>
<tr><td class="sideelt"><a href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/tclsoap/tclsoap">Browse CVS</a></td></tr>

<tr><td class="sidehead">Interop</td></tr>
<tr><td class="sideelt"><a href="silab/round1.html">Round 1 Tests</a></td></tr>
<tr><td class="sideelt"><a href="silab/round2base.html">Round 2 Base</a></td></tr>
<tr><td class="sideelt"><a href="silab/round2B.html">Round 2B</a></td></tr>
<tr><td class="sideelt"><a href="silab/round2C.html">Round 2C</a></td></tr>

<tr><td class="sidehead">Support</td></tr>
<tr><td class="sideelt"><A href="http://sourceforge.net/tracker/?aid=385859&group_id=25970&func=browse">Bugs</A></td></tr>
<tr><td class="sideelt"><A href="http://sourceforge.net/tracker/?aid=385860&group_id=25970&func=browse">Support Requests</A></td></tr>
<tr><td class="sideelt"><A href="http://sourceforge.net/tracker/?aid=385861&group_id=25970&func=browse">Patches</A></td></tr>
<tr><td class="sideelt"><a href="http://sourceforge.net/tracker/?aid=385862&group_id=25970&func=browse">Feature Requests</A></td></tr>
    </table></td>

<td class="body" colspan="2">
<div class="body">

  <!-- ----------------------------------------------------------------- -->

      <p>The <tt>SOAP::Domain</tt> package makes in easy to provide a
      web service implementation in TclHTTPD and to provide both SOAP and
      XML-RPC access. Here is a simple example that
      can be placed in the <tt>custom/</tt> subdirectory of tclhttpd
      that will provide a simple web service.</p>

      <pre>package require SOAP::Domain
SOAP::Domain::register -prefix /rpc

proc square {num} {
    if { [catch {expr $num + 0}] } {
        error "parameter num must be a number"
    }
    return [expr $num * $num]
}
SOAP::export square
XMLRPC::export square
  </pre>

  <p>The first line loads
  in SOAP service support for Tclhttpd. Then we register a url prefix
  with the server that will be redirected to call our web service
  methods. We then define a method and then we use the <tt>export</tt>
  commands to state that this is a public procedure. We do not, after
  all, want people to call any command in the interpreter.</p>

  <p>More complex methods are likely to need to specify the return
  variable type. As tcl doesn't have types we have a package to assist
  us and to tag the return value with an XML-RPC type. For instance,
  one of the XML-RPC types is a date-time point: </p>

  <pre>package require rpcvar

proc date {} {
    set result [clock format [clock seconds] -format {%Y%m%dT%H:%M:%S}]
    return [rpcvar::rpcvar "dateTime.iso8601" $result]
}

SOAP::export date
XMLRPC::export date
  </pre>

    <p>The result here is initially a string formatted in the iso8601
    point in time format. As there is no real way for Tcl to distinguish
    between this string and a non-date string we have to provide a
    hint so that the XML-RPC reply has the correct type
    information.</p>

  <p>For simple types: int, double, string the framework can guess the 
    correct type. For other types, you will need to return a
    TypedVariable as the result.</p>

  <p>A more significant example of this is a method returning an
    array:</p>

<pre>proc sort {lst} {
    return [rpcvar::rpcvar array [lsort $lst]]
}
  </pre>
 
    Here, we are returning an array of sorted elements. The type of
    each element will have to be guessed by the framework as the
    elements themselves cannot be provided with a type.</p>

  <p>XML-RPC supports <tt>struct</tt> results as well as arrays. This
    is supported from Tcl as Tcl arrays. The struct element name is
    set from the array element name.</p>

  <p>For more details about writing services look at the
    <a href="SOAPURLDomain.html"><tt>SOAP::Domain</tt></a>
    documentation.</p>

  <br>
  <br>
  <!-- ----------------------------------------------------------------- -->

</div>
</td></tr>
<tr class="footer">
<td class="footer" colspan="2">
$Id: XMLRPCDomain.html,v 1.3 2001/10/11 22:40:37 patthoyts Exp $
</td></tr>

    </table>
  </body>
</html>

<!-- Local variables:           -->
<!--   truncate-lines: "t"      -->
<!--   indent-tabs-mode: nil    -->
<!-- End:                       -->
