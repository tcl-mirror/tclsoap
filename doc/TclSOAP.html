<!doctype HTML public "-//W3O//DTD W3 HTML 2.0//EN">
  <head>
    <title>SOAP 1.5 Package for Tcl 8.3</title>
    <meta http-equiv="Description" name="Description"
      content="SOAP package for Tcl. Provides remote procedure calls
      using the SOAP protocol over HTTP and utilities to provide Tcl
      procedures as SOAP methods via the tclhttpd server." />
    <meta http-equiv="Keywords" name="Keywords"
      content="Tcl,SOAP,Simple Object Access Protocol,XML,XML-RPC,
      Remote Procedure Call, RPC" />
  </head>

  <body bgcolor="white" text="black">

  <!-- ------------------------------------------------------------------ -->

  <img src="tclsoap.gif" alt="TclSOAP Logo" align="bottom" border="0" />
  <p><h1 align="center">Tcl SOAP Client Utility Packages</h1></p>
  <hr noshade="noshade" size="2" />

  <!-- ------------------------------------------------------------------ -->

  <h1>Contents</h1>
  <ol>
  <li><a href="#introduction">Introduction to TclSOAP</a></li>
  <li><a href="#methods">SOAP Package Commands</a></li>
  <li><a href="SOAPURLDomain.html">TclHTTPD SOAP Server Utilities</a></li>
  <li><a href="XMLRPCDomain.html">TclHTTPD XML-RPC Server Utilities</a></li>
  <li><a href="#download">Download Information</a></li>
  </ol>

  <!-- ------------------------------------------------------------------ -->

  <hr noshade="noshade" size="2" />

  <h1><a name="introduction">Introduction</a></h1>

  <p>I have been testing out using SOAP from Tcl and have come up with
  the following package to provide Tcl commands for SOAP remote
  procedure calls. The following code demonstrates the ease of use for
  simple RPC calls. This is a work in progress and some parts need
  more work. In particular the transport layer needs to be able to be
  configured to cope with proxy HTTP servers and authenticating proxys
  and the like. Still it may be usefull as-is.</p>

  <p>This example connects the Tcl procedure <tt>getTemp</tt> to the
  remote method hosted by <a href="http://www.xmethods.net/">XMethods</a>.
  In all these examples Tcl commands are prefixed with the <tt>%</tt>
  character that is my prompt under tclsh. Results are printed without
  the preceeding prompt character.

    <table border="0" align="bottom" cellpadding="1" cellspacing = "0"
           bgcolor="#c0c0c0"><tr><td align="left"><pre>
% package require SOAP
1.5
% SOAP::create getTemp \
	-uri "urn:xmethods-Temperature" \
	-proxy "http://services.xmethods.net/soap/servlet/rpcrouter" \
	-params { "zipcode" "string" }
::getTemp
% getTemp 90810
41.2
  </pre></td></tr></table>

  We bring in the package and then define the method. The
  configuration requires a URI for the XML namespace of the SOAP
  method and a URL for the service. The <i>params</i> configure option
  allows the Tcl procedure to do simple parameter checking without
  passing duff packets over the network.
  </p>

  <p>Another example, this time using the extremely clever 
    <a href="http://www.soaplite.com/"><tt>SOAP::Lite</tt></a>
    Perl package as a server, a Celcius to Fahrenheit convertor. We
    shall test it using that peculiar temperature -40. This time I
    want the Tcl procedure to be called <tt>C2F</tt>.
    <table border="0" align="bottom" cellpadding="1" cellspacing = "0"
           bgcolor="#c0c0c0"><tr><td align="left"><pre>
% package require SOAP
1.5
% SOAP::create C2F \
	-uri "http://www.soaplite.com/Temperatures" \
	-proxy "http://services.soaplite.com/temper.cgi" \
	-params { "temp" "float"}\
	-name c2f
::C2F
% C2F -40.0
-40
%
    </pre></td></tr></table>
    </p>

    <p>It will be possible to use different transport protocols to
    transfer the SOAP packets. At this time only HTTP is
    supported. You may need to configure the transport subsystem so
    the <tt>SOAP::configure</tt> command has a <i>-transport</i>
    option. For example, at work I live behind a Microsoft NT
    firewalling proxy web server. So I need to tell the SOAP transport
    about the proxy. This is an authenticating proxy, so I have to add
    a header to all HTTP requests using the Proxy-Authorization HTTP
    field. Here's how I set up my system and then create a command for
    the <tt>SOAP::Lite</tt> languages method.

    <table border="0" align="bottom" cellpadding="1" cellspacing = "0"
           bgcolor="#c0c0c0"><tr><td align="left"><pre>
% package require SOAP
1.5
% SOAP::configure -transport http -proxy proxyhost:8080 \
	-headers { "Proxy-Authorization" "Basic dXNlcm5hbWUgOiBwYXNzd29yZA==" }
% SOAP::create languages \
	-uri "http://www.soaplite.com/Demo" \
	-proxy "http://services.soaplite.com/hibye.cgi" \
	-params {}
::languages
% languages
Perl sh C
%
    </pre></td></tr></table>
    </p>

    <p>To setup a method to use a different transport there is a
    <i>-transport</i> option for the method configure command. This
    should be set to the name of a procedure that will be called with
    the URL of the SOAP service and the XML data of the SOAP
    request. It should return the reply packet or error. For example,
    I have a dummy transport procedure that prints the SOAP request
    and doesn't send it anywhere. To see what is being generated for a
    method:

    <table border="0" align="bottom" cellpadding="1" cellspacing = "0"
           bgcolor="#c0c0c0"><tr><td align="left"><pre>	   	   
# A dummy SOAP transport procedure to examine the SOAP requests generated.

proc SOAP::transport_print { url soap } {
    puts "$soap"
    return {}
}

% SOAP::configure languages -transport SOAP::transport_print
::languages
% languages
&lt;?xml version='1.0'?&gt;
&lt;SOAP-ENV:Envelope
    xmlns:xsi="http://www.w3.org/1999/XMLSchema-instance" 
    xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" 
    SOAP-ENV:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/" 
    xmlns:xsd="http://www.w3.org/1999/XMLSchema"&gt;
&lt;SOAP-ENV:Body&gt;
   &lt;ns:languages xmlns:ns="http://www.soaplite.com/Demo" /&gt;
&lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;
%
    </pre></td></tr></table>

    For debugging purposes it can be useful to see the XML that was
    generated for the SOAP method request at each end. The
    <tt>SOAP::dump</tt> command will return the XML for the last
    transaction using HTTP for a named method.
    </p>
    
    <hr size="2" />

    <h1><a name="methods">Methods</a></h1>

<!-- SOAP::create -->
    <dl>
    <dt>SOAP::create <i>methodName ?option value ...?</i></dt>
       <dd><p>Create a Tcl binding for a remote procedure call using
        SOAP. See <b>configure</b> for the permitted options.</p></dd>

<!-- SOAP::configure -transport -->
    <dt>SOAP::configure -transport <i>protocol ?option value ...?</i></dt>
    <dd><p>Used for global configuration of the available
    transports. The options passed in to this command are dependent on
    the transport mchanism. The only transports currently available<p>

    <p>The HTTP transport may require a proxy server and possible
    other headers to be included. This is where to add this
    information. For example, to pass an authenticating proxy server I
    need to provide the name of the server and a Proxy-Authorize HTTP
    header using the Trf package to provide the base64 encoding
    procedure.
<pre>
SOAP::configure -transport http -proxy wwwproxy:8080 \ 
       -headers { "Proxy-Authorize" "Basic [base64 -enc user:pass]" }
</pre></p>
    </dd>

<!-- SOAP::configure -->
    <dt>SOAP::configure <i>methodName ?option value ...?</i></dt>
    <dd><dl>

    <dt>-uri <i>URI</i></dt>
       <dd>The URI for the XML namespace in which this
       method has been defined.</dd>

    <dt>-proxy <i>URL</i></dt>
       <dd>Specify the URL of the server providing the
       implementation of this method.</dd>

    <dt>-params <i>list</i></dt>
       <dd>Configure the parameters required for this
       method. <i>list</i> should be a list of pairs consisting of the
       parameter name and the parameter type. The Tcl procedure will
       check the number of parameters when constructing the SOAP
       request. e.g.: <tt><pre>
SOAP::configure getTemp -params { "zipcode" "string" }
SOAP::configure c2f -params { "temperature" "float" }
SOAP::configure hi -params {}
       </pre></tt></dd>

    <dt>-transport <i>protocolProc</i></dt>
       <dd>Select the transport protocol used for this
       method. <i>protocolProc</i> should be a Tcl command procedure that
       takes the URL of the SOAP server and the SOAP XML data to be
       sent. This procedure will send the request and receive the
       answer.</dd>

    <dt>-name <i>methodName</i></dt>
       <dd>By default a Tcl command is
       created in the current namespace with the same name as the SOAP
       method. If the Tcl procedure is created with a different name then
       the <i>-name</i> configuration option must be used to set the SOAP
       method name explicitly.</dd>

    <dt>-action <i>SOAPActionValue</i></dt>
       <dd>The SOAP 1.1 specification requires SOAP POST requests to
       have an HTTP SOAPAction header. This may have an empty value if
       not required (which is the default) or it may be required to be
       set to a specific value to pass though firewalls.</dd>

<!--    <dt>-xmlrpc <i>boolean</i></dt>
       <dd>If this option is set to true then the method is configured
       to use the XML-RPC protocol instead of the SOAP protocol. This
       defaults to false for the SOAP package and to true for the
       XMLRPC package. This is the only configuration option required
       to convert a method from SOAP to XML-RPC. The effect of setting
       this flag is to select an alternative XML packaging procedure
       and an alternative XML parsing procedure (via the <i>-parseProc</i>
       option). The SOAP package defines one for SOAP replies and
       another for XML-RPC replies.
       </dd> -->

    <dt>-wrapProc <i>procedureName</i></dt>
       <dd>Set the procedure used to wrap up the method parameters for
       transport to the server. This procedure takes the SOAP
       methodName followed by all the parameters required for the
       method call and returns the generated XML data for the RPC
       call. By default for SOAP requests this is set to
       <tt>SOAP::soap_request</tt> and for XML-RPC methods to
       <tt>SOAP::xmlrpc_request</tt>. This option is only likely to be 
       used if you are implementing a new RPC protocol.
       </dd>

    <dt>-replyProc <i>procedureName</i></dt>
       <dd>A hook procedure can be defined to be called once the
       response packet has been received but before the XML is
       parsed. Provided the server returned an HTTP 200 response then
       this procedure is guarunteed to be called even if the reply
       contains an error response. The procedure is called with two
       parameters, the first being the SOAP method name and the second
       being the XML text of the reply. The hook procedure should
       return the new XML text suitable for processing by the
       <i>-parseProc</i> procedure. For example:
<pre>proc my_reply_hook { methodName xml } {
   puts "$xml"
   return $xml
}</pre>
       </dd>

    <dt>-parseProc <i>procedureName</i></dt>
       <dd>Specify the procedure used to parse the XML of the reply
       and to extract the result value. The default depends upon the
       setting of the <i>-xmlrpc</i> configuration option and is either
       <tt>SOAP::parse_soap_response</tt> or 
       <tt>SOAP::parse_xmlrpc_response</tt>. The procedure takes two
       parameters as for the <i>-replyProc</i> option but should return the
       result value from the XML packet.</dd>

    <dt>-postProc <i>procedureName</i></dt>
       <dd>An optional hook procedure may be specified here that will
       be called once the result value has been obtained from the XML
       packet. This procedure will take two parameters, the first is
       the SOAP method name and the second the result value extracted
       from the XML. The procedure should return the new result value.
       By default no procedure is defined.</dd>

    <dt>-command <i>callback</i></dt>
       <dd>Provide support for asynchronous methods. This option
       causes the SOAP method invocation to return immediately and the
       <i>callback</i> procedure is called once the round trip finally
       completes. The procedure will be called with an additional
       argument that is the data returned by the remote method. The
       callback procedure must exist before the SOAP method is
       configured as the procedure name is namespace qualified during
       configuration.
<pre>   proc gotInfo {window data} { ... }
   SOAP::configure getInfo -command {gotInfo .frame1.edit} ...
</pre></dd>

    </dl></dd><br>

<!-- SOAP::cget -->
    <dt>SOAP::cget <i>methodName option</i></dt>
      <dd><p>Retrieve a configuration value from the method. The
    <i>optionName</i> should be one of those listed for
    <i>configure</i>. There is one additional read-only value to be
    obtained:<br>
    <dl><dt>http</dt>
      <dd>retrieve the handle for the last HTTP
      request. This is only set if the transport in use is HTTP. You can
      examine the HTTP data using  procedures from the http package. i.e.:<br>
      <tt>puts "[::http::data [SOAP::cget getTemp http]]"</tt><br>
      or <br>
      <tt>set r [::http::code [SOAP::cget getTemp http]]</tt>
      </dd>
    </dl>
    </p></dd>

<!-- SOAP::dump -->
    <dt>SOAP::dump <i>option</i> <i>methodName</i></dt>
      <dd><p>Returns information about the last HTTP transaction.
      <dl>
        <dt>-reply</dt>
        <dd>returns the XML text of the servers reply</dd>
        <dt>-request</dt>
        <dd>returns the XML text that was sent to the server</dd>
        <dt>-meta</dt>
        <dd>returns the HTTP protocol meta information</dd>
      </dl></p></dd>

<!-- SOAP::invoke -->
    <dt>SOAP::invoke <i>methodName methodParameters</i></dt>
       <dd><p>Make a SOAP call to the configured server. This is not
       expected to be called by a user but is called by the Tcl command
       procedure for this SOAP method.</p></dd>

<!-- SOAP::proxyconfig -->
    <dt>SOAP::proxyconfig</dt>
      <dd><p>This command presents a dialog box used to configure the
      SOAP package to work with a proxy server. The fields are used to
      call <tt>SOAP::configure -transport http</tt> with the relevant
      options. The first entry field takes the name and port of the
      proxy server (eg: webproxy:8080) and the second two fields are
      used to configure a Basic Authentication HTTP header allow
      operation with an authenticating proxy. (ie: an NT IIS server).
      </p></dd>

<!-- end of SOAP commands list -->
    </dl>
  </p>

  <hr noshade="noshade" size="2" />

  <h1><a name="download">Download</a></h1>

  <p>The package can be downloaded from the SourceForge project site
    at <a href="http://sourceforge.net/projects/tclsoap">SourceForge</a>
    or from the SourceForge anonymous FTP site at
    <a href="TclSOAP-1.5.1.tar.gz">
       ftp://tclsoap.sourceforge.net/pub/tclsoap/TclSOAP-1.5.1tar.gz
    </a>.
    This file should be unpacked somewhere handy and you should set
    your TCLLIBPATH environment variable to suit. For windows users,
    you may as well unpack it to <tt>Program Files\Tcl\lib\tcl8.3</tt>
  </p>

  <p>The source is spread over the following files. These files have
    all been htmlized so if you want to <em>use</em> them, rather than
    just look at them, get and unpack the tar.gz distribution.

    <dl>
    <dt><a href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/tclsoap/tclsoap/SOAP.tcl?rev=soap1_5_1&content-type=text/vnd.viewcvs-markup">SOAP.tcl</a></dt>
    <dd>The SOAP package.</dd>
    <dt><a href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/tclsoap/tclsoap/XMLRPC.tcl?rev=soap1_5_1&content-type=text/vnd.viewcvs-markup">XMLRPC.tcl</a></dt>
    <dd>The XMLRPC equivalent of the SOAP package.</dd>
    <dt><a href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/tclsoap/tclsoap/SOAP-parse.tcl?rev=soap1_5_1&content-type=text/vnd.viewcvs-markup">SOAP-parse.tcl</a></dt>
    <dd>An auxiliary package to used to parse reply packets.</dd>
    <dt><a href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/tclsoap/tclsoap/SOAP-domain.tcl?rev=soap1_5_1&content-type=text/vnd.viewcvs-markup">SOAP-domain.tcl</a></dt>
    <dd>A package to provide SOAP services from tclhttpd.</dd>
    <dt><a href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/tclsoap/tclsoap/SOAP-service.tcl?rev=soap1_5_1&content-type=text/vnd.viewcvs-markup"">SOAP-service.tcl</a></dt>
    <dd>A sample standalone Tcl SOAP server using HTTP.</dd>
    <dt><a href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/tclsoap/tclsoap/xpath.tcl?rev=soap1_5_1&content-type=text/vnd.viewcvs-markup"">xpath.tcl</a></dt>
    <dd>A simple pseudo-XPath XML querying package. (depreciated - use
    the XPath facilities in TclDOM 2.0)</dd>
    <dt><a href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/tclsoap/tclsoap/samples/SOAP-tests.tcl?rev=soap1_5_1&content-type=text/vnd.viewcvs-markup"">SOAP-tests.tcl</a></dt>
    <dd>A number of test methods from various public SOAP servers on
    the internet.</dd>
    <dt><a href="http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/tclsoap/tclsoap/samples/XMLRPC-tests.tcl?rev=soap1_5_1&content-type=text/vnd.viewcvs-markup"">XMLRPC-tests.tcl</a></dt>
    <dd>A number of test methods from various public XML-RPC servers on
    the internet.</dd>
    </dl>
  </p>

  <hr noshade="noshade" size="2" />

  <p>This site is hosted by 
    <a href="http://www.sourceforge.net/">SourceForge</a>.
  </p>

  <font size="2">
<!-- Created: Wed Mar 14 00:26:30 GMT 2001 -->
<!-- hhmts start -->
Last modified: Mon Jun 25 01:28:53 BST 2001
<!-- hhmts end -->

  <br><tt>$Id: TclSOAP.html,v 1.11 2001/06/21 00:28:40 patthoyts Exp $</tt>
  </font>

  </body>
</html>

<!-- Local variables:           -->
<!--   truncate-lines: "t"      -->
<!--   indent-tabs-mode: nil    -->
<!-- End:                       -->
