<!doctype HTML public "-//W3O//DTD W3 HTML 2.0//EN">
  <head>
    <title>SOAP URL Domain Package for TclHTTPD</title>
    <meta http-equiv="Description" name="Description"
      content="SOAP package for Tcl. Provides remote procedure calls
      using the SOAP protocol over HTTP." />
    <meta http-equiv="Keywords" name="Keywords"
      content="Tcl,SOAP,Simple Object Access Protocol,XML,tclHTTPD" />
  </head>

  <body bgcolor="white" text="black">

  <!-- ----------------------------------------------------------------- -->

  <img src="tclsoap.gif" alt="TclSOAP Logo" align="bottom" border="0" />
  <p><h1 align="center">Tcl SOAP Server Utility Package</h1></p>
  <hr noshade="noshade" size="2" />

  <!-- ----------------------------------------------------------------- -->

  <p>The <tt>SOAP::Domain</tt> package provides a wrapper enabling the
  simple use of Tcl procedures as SOAP methods. The package is
  designed to operate with the tclhttpd web server but in principal
  could be converted to another server fairly easily. </p>

  <p>As an example of its use enter the following code and save as
  <tt>soap1.tcl</tt> in the custom subdirectory of the tclhttp
  server. (Alternatively source this script into a running
  server).</p>

    <table border="0" align="bottom" cellpadding="1" cellspacing = "0"
           bgcolor="#c0c0c0"><tr><td align="left"><pre>
package require SOAP::Domain
SOAP::Domain::register -prefix /soap -namespace zsplat::Test

proc zsplat::Test::/square {num} {
    if { [catch {expr $num + 0}] } {
        error "parameter num must be a number"
    }
    return [expr $num * $num]
}
  </pre></td></tr></table>

  <p>This block of code loads the SOAP server utilities (the
  SOAP::Domain package) and registers a handler for the /soap URL
  namespace with the http server. The effect of this is that any URL
  under /soap will be handled by SOAP::Domain::domain_handler. This
  procedure examines incoming SOAP requests and attempts to evaluate
  corresponding procedures in the specified namespace. By specifying a
  namespace we can isolate the soap procedures from any other
  procedures defined in the server. If we require an additional level
  of security we can specify a named slave interpreter rather than a
  namespace and then define our soap methods within the slave
  interpreter.</p>

  <p>We can test the above server by entering the following script to
  get a SOAP command in Tcl to use this service.</p>

    <table border="0" align="bottom" cellpadding="1" cellspacing = "0"
           bgcolor="#c0c0c0"><tr><td align="left"><pre>
% package require SOAP
1.3
% SOAP::create square \
           -uri urn:zsplat-Test \
           -proxy http://localhost:8015/soap/square \
           -params {num integer}
::square
% square 8
64
  </pre></td></tr></table>

  <p>Errors returned by the Tcl procedure are converted into SOAP
  Fault reply packets. According to the SOAP 1.1 specification the
  presence of a detail element under the Fault element is indicative
  of a failure in evaluating the body of the SOAP
  request. For errors thrown by the evaluated procedure this package
  generates a Fault packet and places the contents of the global
  errorInfo variable into the detail element.</p>

  <p>To illustrate this, if we evaluate the following in the server

  <table border="0" align="bottom" cellpadding="1" cellspacing = "0"
         bgcolor="#c0c0c0"><tr><td align="left"><pre>
% catch {square Hello} msg
1
% puts "$msg"
SOAP-ENV:Client {parameter num must be a number}
% SOAP::dump square
&lt;?xml version='1.0'?&gt;
&lt;SOAP-ENV:Envelope 
  xmlns:xsi="http://www.w3.org/1999/XMLSchema-instance" 
  xmlns:SOAP-ENV="http://schemas.xmlsoap.org/soap/envelope/" 
  xmlns:xsd="http://www.w3.org/1999/XMLSchema"&gt;
  &lt;SOAP-ENV:Body&gt;
    &lt;SOAP-ENV:Fault&gt;
      &lt;faultcode&gt;SOAP-ENV:Client&lt;/faultcode&gt;
      &lt;faultstring&gt;parameter num must be a number&lt;/faultstring&gt;
      &lt;detail&gt;
        &lt;e:errorInfo xmlns:e="urn:TclSOAP-ErrorInfo"&gt;
          &lt;errorCode&gt;NONE&lt;/errorCode&gt;
          &lt;stackTrace&gt;parameter num must be a number
    while executing
&quot;error &quot;parameter num must be a number&quot;&quot;
    (procedure &quot;::zsplat::Test::/square&quot; line 3)
    invoked from within
&quot;::zsplat::Test::/square Hello&quot;
    invoked from within
&quot;interp eval $xmlinterp [list $xmlns] $argValues&quot;&lt;/stackTrace&gt;
        &lt;/e:errorInfo&gt;
      &lt;/detail&gt;
    &lt;/SOAP-ENV:Fault&gt;
  &lt;/SOAP-ENV:Body&gt;
&lt;/SOAP-ENV:Envelope&gt;
  </pre></td></tr></table>

  As can be seen from the XML data, if an error is raised by the Tcl
  implementation of the SOAP method then the SOAP::Domain package
  includes the stack trace (from the global variable errorLevel) as
  one of the detail elements. This is very useful for debugging such
  procedures.</p>

  <!-- ----------------------------------------------------------------- -->

  <hr noshade="noshade" size="2" />

  <p>This site is hosted by 
    <a href="http://www.sourceforce.net/>SourceForge</a>
  </p>

  <font size="2">
<!-- Created: Thu Apr 12 17:32:20 2001
<!-- hhmts start -->
Last modified: Thu Apr 19 01:25:09 2001
<!-- hhmts end -->

  <br><tt>$Id: SOAPURLDomain.html,v 1.2 2001/04/22 21:54:04 pat Exp $</tt>
  </font>

  </body>
</html>

<!-- Local variables:           -->
<!--   truncate-lines: "t"      -->
<!--   indent-tabs-mode: nil    -->
<!-- End:                       -->
